(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{1113:function(E,l,r){"use strict";r.r(l);var m=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("LazyFormDialogFull",{ref:"dialogForm",scopedSlots:e._u([{key:"content",fn:function(){return[t("LazyDocumentFormDocument",{ref:"formDocument",attrs:{"form-type":e.formType}})]},proxy:!0},{key:"actions",fn:function(){return[t("v-btn",{attrs:{text:"",small:"",dark:""}},[e._v("Print or Preview")]),e._v(" "),t("v-divider",{attrs:{dark:"",vertical:""}}),e._v(" "),t("v-btn",{attrs:{text:"",small:"",dark:""}},[e._v("Make recurring")]),e._v(" "),t("v-divider",{attrs:{dark:"",vertical:""}}),e._v(" "),t("v-btn",{attrs:{text:"",small:"",dark:""}},[e._v("More")]),e._v(" "),t("v-spacer"),e._v(" "),t("v-btn",{staticClass:"mr-3",attrs:{small:"",color:"green darken-1",dark:"",loading:e.loading},on:{click:function(o){return e.actionSave("saveNew")}}},[e._v(`
      Save and new

      `),t("v-menu",{attrs:{transition:"slide-y-transition",bottom:""},scopedSlots:e._u([{key:"activator",fn:function(o){var n=o.on,i=o.attrs;return[t("v-btn",e._g(e._b({attrs:{dark:"",icon:""}},"v-btn",i,!1),n),[t("v-icon",[e._v("mdi-menu-down")])],1)]}}])},[e._v(" "),t("v-list",{attrs:{link:""}},e._l(e.items,function(o,n){return t("v-list-item",{key:n,on:{click:function(i){return e.actionSave(o.action)}}},[t("v-list-item-content",[t("v-list-item-title",[e._v(e._s(o.text))])],1)],1)}),1)],1)],1)]},proxy:!0}])},[t("v-overlay",{attrs:{value:e.showLoading}},[t("v-progress-circular",{attrs:{indeterminate:"",size:"64"}})],1)],1)},d=[],A=r(59),C=r(4),k=r(32),I=r(35),O=r(806),j=r(291),v={name:"DialogForm",props:{url:{type:String,default:"/api/documents"},formType:{type:String,default:""},formUrl:{type:String,default:""},dialogTitle:{type:String,default:""}},data:function(){return{title:this.dialogTitle,items:[{text:"Save and send",action:"saveSend"},{text:"Save and close",action:"saveClose"}],breadcrumb:[],form:{},audits:{},defaultItem:{},dialogLoading:!1,showLoading:!1,dialog:!0,loading:!1,itemAction:[],actionName:"Save"}},activated:function(){var a=this;setTimeout(function(){a.$refs.dialogForm.openDialog(),a.$refs.dialogForm.openDialog(),a.getDataFromApi()},300)},mounted:function(){var a=this;setTimeout(function(){a.$refs.dialogForm.openDialog(),a.$refs.dialogForm.openDialog(),a.getDataFromApi()},300)},methods:{close:function(){this.$router.back(),this.$emit("getDataFromApi")},checkDisable:function(){return this.form.status==="closed"||this.form.status==="cancel"},arrowLink:function(a,t){var o=this;this.$axios.get(this.url+"/arrow",{params:{type:t,status:a,document:this.$route.query.document}}).then(function(n){o.$router.push({path:"/dashboard/documents",query:{document:n.data.data.id,type:t}}),setTimeout(function(){o.getDataFromApi()},300)}).catch(function(n){o.$swal({type:"error",title:"Error",text:n.response.data.message})})},getDataFromApi:function(a){var t=this;this.$nuxt.$loading.start();var o=this.formType;this.$axios.get(this.url+"/"+this.$route.query.document,{params:{type:o,copyFromId:a}}).then(function(n){var i="";t.audits=n.data.data.audits,n.data.data.count>0?(i=n.data.data.rows,t.actionName="Update"):(i=n.data.data.form,t.actionName="Save"),t.form=Object.assign({},i),t.defaultItem=Object.assign({},i),t.title=t.dialogTitle+" #"+t.form.document_number,t.$refs.dialogForm.setTitle(t.title),t.$refs.formDocument.setData(t.form)}).catch(function(n){var i=n.response!==void 0?n.response.data.message:n;t.$swal({type:"error",title:"Error",text:i})}).finally(function(n){t.$nuxt.$loading.finish()})},actionDocument:function(a){var t=this,o=this.$route.query.document;switch(a){case"SQ":case"SO":case"PQ":case"PO":this.$router.push({path:"/dashboard/documents/form",query:{document:0,type:a}}),setTimeout(function(){t.actionName="Save",t.$refs.formDocument.changeValue("type",a),t.$refs.formDocument.changeValue("parent_id",o)},300);break;case"C":this.$refs.formDocument.changeValue("status","cancel"),this.store();break;case"sendEmail":this.openDialogEmail();break}},deleteDocument:function(a){var t=this,o=this;this.$swal({title:"Are you sure?",text:"The data will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(function(n){n.value&&t.$axios.delete(t.url+"/"+a).then(function(i){t.$swal({type:"success",title:"Success...",text:"Data Deleted!"}),t.$router.push({path:o.$helper.mappingAction(o.$route.query.type)})}).catch(function(i){t.$swal({type:"error",title:"Oops...",text:i.response.data.message})})})},printAction:function(a){switch(a){case"preview":this.previewDocument();break;case"sendEmail":this.openDialogEmail();break}},openDialogEmail:function(){this.$refs.dialogSendEmail.openEmailDialog(this.form)},previewDocument:function(){var a=this,t=this;this.dialogLoading=!0,this.$axios.get("/api/documents/print",{params:{id:t.form.id},responseType:"arraybuffer"}).then(function(o){a.dialogLoading=!1;var n=window.URL.createObjectURL(new Blob([o.data])),i=document.createElement("a");i.href=n,i.setAttribute("download",t.form.document_number+".pdf"),document.body.appendChild(i),i.click()}).catch(function(o){a.dialogLoading=!1,a.$swal({type:"error",title:"Error",text:o.response.data.message})})},actionSave:function(a){var t=this,o=this.$route.query.document,n=o==="0"?this.url:this.url+"/"+o,i=o==="0"?"post":"patch",L=this.$refs.formDocument.returnData(o),T=this;this.loading=!0,this.$axios({method:i,url:n,data:L}).then(function(s){t.$router.push({path:T.formUrl,query:{document:s.data.data.id}}),t.$nuxt.$emit("snackbar",s.data.message),setTimeout(function(){t.getDataFromApi()},50)}).catch(function(s){t.$swal({type:"error",title:"Error",text:s.response.data.message})}).finally(function(s){t.loading=!1})}}},f=v,h=r(50),p=r(51),g=r.n(p),y=r(164),D=r(572),$=r(246),x=r(248),V=r(165),c=r(34),S=r(573),F=r(245),b=r(242),w=r(589),u=Object(h.a)(f,m,d,!1,null,null,null),B=l.default=u.exports;g()(u,{VBtn:y.a,VDivider:D.a,VIcon:$.a,VList:x.a,VListItem:V.a,VListItemContent:c.b,VListItemTitle:c.d,VMenu:S.a,VOverlay:F.a,VProgressCircular:b.a,VSpacer:w.a})}}]);
