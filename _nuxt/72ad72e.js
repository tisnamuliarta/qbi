(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{1043:function(t,e,r){"use strict";r.r(e);var o=r(25),n=r(64),c=(r(74),r(59),r(28),r(4),r(32),r(35),r(668),r(293),{name:"DialogForm",props:{url:{type:String,default:"/api/production/order"},formType:{type:String,default:"PE"},formUrl:{type:String,default:"/app/form/production/order"},dialogTitle:{type:String,default:"Production order"}},data:function(){return{title:this.dialogTitle,items:[{text:"Save and close",action:"saveClose"},{text:"Save and new",action:"saveNew"},{text:"Save and send",action:"saveSend"}],itemAction:[],action:[],breadcrumb:[],form:{},audits:{},defaultItem:{},dialogLoading:!1,showLoading:!0,dialog:!0,loading:!1,actionName:"Save",actionOnSave:"save",countRouter:-1}},head:function(){return{title:this.$t("Production Order")}},activated:function(){var t=this;this.$nextTick((function(){t.$nuxt.$loading.start()})),setTimeout((function(){t.action=[],t.itemAction=[{text:"Copy",action:"copy"},{text:"Cancel",action:"cancel"},{text:"Audit History",action:"history"}],t.itemAction=t.appendItemAction(t.formType),t.$refs.dialogForm.openDialog(),t.getDataFromApi()}),300)},methods:{close:function(){this.$emit("getDataFromApi")},checkDisable:function(){return"closed"===this.form.status||"cancel"===this.form.status},appendItemAction:function(t){return this.action=[],[].concat(Object(n.a)(this.action),Object(n.a)(this.itemAction))},arrowLink:function(t,e){var r=this;this.$axios.get(this.url+"/arrow",{params:{type:e,status:t,document:this.$route.query.document}}).then((function(t){r.$router.push({path:"/dashboard/documents",query:{document:t.data.id,type:e}}),setTimeout((function(){r.getDataFromApi()}),300)})).catch((function(t){r.$swal({type:"error",title:"Error",text:t.response.data.message})}))},getDataFromApi:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var o,n,c,form,m;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.showLoading=!0,r.prev=1,o=e.formType,n=e.$route.query.copyFrom,c="",!n){r.next=11;break}return r.next=8,e.$axios.get("/api/document/copy/"+n);case 8:c=r.sent,r.next=14;break;case 11:return r.next=13,e.$axios.get(e.url+"/"+e.$route.query.document,{params:{type:o,copyFromId:t}});case 13:c=r.sent;case 14:form="",e.audits=c.data.audits,0===c.data.count?(form=c.data.form,e.actionName="Save"):(form=c.data.data,e.actionName="Update"),e.form=Object.assign({},form),e.defaultItem=Object.assign({},form),n&&(e.form.status="open",e.form.base_id=e.form.id,e.form.base_type=e.form.transaction_type,e.form.base_num=e.form.transaction_no,e.form.transaction_type=e.formType),e.title=e.dialogTitle+" #"+e.form.transaction_no,e.$refs.dialogForm.setTitle(e.title),e.$refs.formDocument.setData(e.form),e.showLoading=!1,r.next=30;break;case 26:r.prev=26,r.t0=r.catch(1),m=void 0!==r.t0.response?r.t0.response.data.message:r.t0,e.$swal({type:"error",title:"Error",text:m});case 30:case"end":return r.stop()}}),r,null,[[1,26]])})))()},actionItem:function(t){if("copy"===t)this.$router.push({path:this.formUrl,query:{document:0}}),this.form.status="open",this.$refs.formDocument.setData(this.form);else this.$router.push({path:this.mappingAction(t),query:{document:0,copyFrom:this.form.id}}),this.form.status="open",this.form.base_id=this.form.id,this.form.base_type=this.form.transaction_type,this.form.base_num=this.form.document_number,this.$refs.formDocument.setData(this.form)},mappingAction:function(t){switch(t){case"SQ":return"/app/form/sales/quote";case"SO":return"/app/form/sales/order";case"SD":return"/app/form/sales/delivery";case"IN":return"/app/form/sales/invoice";case"RC":return"/app/form/sales/payment";case"CN":return"/app/form/sales/creditmemo";case"SR":return"/app/form/sales/return";case"PQ":return"/app/form/purchase/quote";case"PO":return"/app/form/purchase/order";case"GR":return"/app/form/purchase/receipt";case"BL":return"/app/form/purchase/invoice";case"PY":return"/app/form/purchase/payment";case"DN":return"/app/form/purchase/creditmemo";case"GN":return"/app/form/purchase/return"}},actionDocument:function(t){var e=this,r=this.$route.query.document;switch(t){case"SQ":case"SO":case"PQ":case"PO":this.$router.push({path:"/dashboard/documents/form",query:{document:0,type:t}}),setTimeout((function(){e.actionName="Save",e.$refs.formDocument.changeValue("type",t),e.$refs.formDocument.changeValue("parent_id",r)}),300);break;case"C":this.$refs.formDocument.changeValue("status","cancel"),this.store();break;case"sendEmail":this.openDialogEmail()}},printAction:function(t){switch(t){case"preview":this.previewDocument();break;case"sendEmail":this.openDialogEmail()}},openDialogEmail:function(){this.$refs.dialogSendEmail.openEmailDialog(this.form)},previewDocument:function(){var t=this,e=this;this.$refs.dialogForm.showLoading(),this.$axios.get("/api/document/print",{params:{id:e.form.id,type:e.form.transaction_type},responseType:"arraybuffer"}).then((function(r){t.$refs.dialogForm.finishLoading();var o=window.URL.createObjectURL(new Blob([r.data])),link=document.createElement("a");link.href=o,link.setAttribute("download",e.form.transaction_no+".pdf"),document.body.appendChild(link),link.click()})).catch((function(e){t.$refs.dialogForm.finishLoading(),t.$swal({type:"error",title:"Error",text:e.response.data.message})}))},actionSave:function(t){var e=this;this.actionOnSave=t;var r=this.$route.query.document,o="0"===r?this.url:this.url+"/"+r,n="0"===r?"post":"patch",data=this.$refs.formDocument.returnData(r),c=this;this.loading=!0,this.showLoading=!0,this.$axios({method:n,url:o,data:data}).then((function(t){switch(e.$nuxt.$emit("snackbar",e.title+" saved!"),e.actionOnSave){case"save":e.$router.push({path:c.formUrl,query:{document:t.data.id}}),setTimeout((function(){e.getDataFromApi()}),50);break;case"saveNew":e.$router.push({path:c.formUrl,query:{document:0}}),setTimeout((function(){e.getDataFromApi()}),50);break;case"saveClose":e.$refs.dialogForm.closeDialog()}})).catch((function(t){e.$swal({type:"error",title:"Error",text:t.response.data.message})})).finally((function(t){e.showLoading=!1,e.loading=!1}))}}}),m=r(50),d=r(51),l=r.n(d),f=r(164),h=r(576),v=r(247),y=r(249),_=r(165),$=r(34),w=r(577),k=r(246),D=r(243),x=r(593),component=Object(m.a)(c,(function(){var t=this,e=t._self._c;return e("LazyFormDialogFull",{ref:"dialogForm",scopedSlots:t._u([{key:"content",fn:function(){return[e("LazyProductionFormProduction",{ref:"formDocument",attrs:{"form-type":t.formType}})]},proxy:!0},{key:"actions",fn:function(){return["Update"===t.actionName?e("span",[e("v-btn",{attrs:{text:"",small:"",dark:""},on:{click:function(e){return t.printAction("preview")}}},[t._v("Print or Preview")]),t._v(" "),e("v-divider",{attrs:{dark:"",vertical:""}}),t._v(" "),e("v-btn",{attrs:{text:"",small:"",dark:""}},[t._v("Make recurring")]),t._v(" "),e("v-divider",{attrs:{dark:"",vertical:""}}),t._v(" "),e("v-btn",{attrs:{text:"",small:"",dark:""}},[t._v("\n          More\n          "),e("v-menu",{attrs:{transition:"slide-y-transition",bottom:""},scopedSlots:t._u([{key:"activator",fn:function(r){var o=r.on,n=r.attrs;return[e("v-btn",t._g(t._b({attrs:{dark:"",icon:""}},"v-btn",n,!1),o),[e("v-icon",[t._v("mdi-menu-down")])],1)]}}],null,!1,1025138851)},[t._v(" "),e("v-list",{attrs:{link:""}},t._l(t.itemAction,(function(r,i){return e("v-list-item",{key:i,on:{click:function(e){return t.actionItem(r.action)}}},[e("v-list-item-content",[e("v-list-item-title",[t._v(t._s(r.text))])],1)],1)})),1)],1)],1)],1):t._e(),t._v(" "),e("v-spacer"),t._v(" "),e("v-btn",{staticClass:"mr-3",attrs:{small:"",color:"green darken-1",dark:"",loading:t.loading,disabled:"closed"===t.form.status},on:{click:function(e){return t.actionSave("save")}}},[t._v("\n        "+t._s(t.actionName)+"\n\n        "),e("v-menu",{attrs:{transition:"slide-y-transition",bottom:""},scopedSlots:t._u([{key:"activator",fn:function(r){var o=r.on,n=r.attrs;return[e("v-btn",t._g(t._b({attrs:{dark:"",icon:"",disabled:"closed"===t.form.status}},"v-btn",n,!1),o),[e("v-icon",[t._v("mdi-menu-down")])],1)]}}])},[t._v(" "),e("v-list",{attrs:{link:""}},t._l(t.items,(function(r,i){return e("v-list-item",{key:i,on:{click:function(e){return t.actionSave(r.action)}}},[e("v-list-item-content",[e("v-list-item-title",[t._v(t._s(r.text))])],1)],1)})),1)],1)],1)]},proxy:!0}])},[e("v-overlay",{attrs:{value:t.showLoading}},[e("v-progress-circular",{attrs:{indeterminate:"",size:"64"}})],1)],1)}),[],!1,null,null,null);e.default=component.exports;l()(component,{VBtn:f.a,VDivider:h.a,VIcon:v.a,VList:y.a,VListItem:_.a,VListItemContent:$.a,VListItemTitle:$.c,VMenu:w.a,VOverlay:k.a,VProgressCircular:D.a,VSpacer:x.a})}}]);