(window.webpackJsonp=window.webpackJsonp||[]).push([[168],{1024:function(A,m,r){"use strict";r.r(m);var f=r(165),p=r(246),h=r(243),y=r(591),g=function(){var a=this,t=a._self._c;return t("LazyFormDialogFull",{ref:"dialogForm",on:{arrowLink:a.arrowLink,closeDialog:a.closeDialog},scopedSlots:a._u([{key:"content",fn:function(){return[t("LazyPayrollFormPayCheck",{ref:"formDocument",attrs:{"form-type":a.formType}})]},proxy:!0},{key:"actions",fn:function(){return[t(y.a),a._v(" "),t(f.a,{staticClass:"mr-3",attrs:{small:"",color:"green darken-1",dark:"",loading:a.loading,disabled:a.form.status==="closed"},on:{click:function(c){return a.actionSave("save")}}},[a._v(`
      `+a._s(a.actionName)+`
    `)])]},proxy:!0}])},[t(p.a,{attrs:{value:a.showLoading}},[t(h.a,{attrs:{indeterminate:"",size:"64"}})],1)],1)},v=[],$=r(24),d=r(63),L=r(73),T=r(58),w=r(28),S=r(4),D={name:"DialogForm",props:{url:{type:String,default:"/api/payroll/payroll"},formType:{type:String,default:"PE"},formUrl:{type:String,default:"/app/form/payroll/pay-check"},dialogTitle:{type:String,default:"Paycheck list"},tableUrl:{type:String,default:"/app/payroll/pay-check"}},data:function(){return{title:this.dialogTitle,itemAction:[],action:[],breadcrumb:[],form:{},audits:{},defaultItem:{},dialogLoading:!1,showLoading:!0,dialog:!0,loading:!1,actionName:"Save",actionOnSave:"save",countRouter:-1}},head:function(){return{title:this.$t("Paycheck list")}},activated:function(){var a=this;this.$nextTick(function(){a.$nuxt.$loading.start()}),setTimeout(function(){a.action=[],a.itemAction=[{text:"Copy",action:"copy"},{text:"Cancel",action:"cancel"},{text:"Audit History",action:"history"}],a.itemAction=a.appendItemAction(a.formType),a.$refs.dialogForm.openDialog(),a.getDataFromApi()},500)},methods:{close:function(){this.$emit("getDataFromApi")},checkDisable:function(){return this.form.status==="closed"||this.form.status==="cancel"},appendItemAction:function(a){return this.action=[],[].concat(Object(d.a)(this.action),Object(d.a)(this.itemAction))},closeDialog:function(){this.$router.push({path:this.tableUrl})},arrowLink:function(a){var t=this;this.$refs.dialogForm.showLoading(),this.$axios.get(this.url+"/arrow",{params:{type:this.formType,status:a.status,document:this.$route.query.document}}).then(function(o){t.$router.push({path:t.formUrl,query:{document:o.data.id}}),setTimeout(function(){t.getDataFromApi()},300),t.$refs.dialogForm.finishLoading()}).catch(function(o){t.$refs.dialogForm.finishLoading(),t.$swal({type:"error",title:"Error",text:o.response.data.message})})},getDataFromApi:function(a){var t=this;return Object($.a)(regeneratorRuntime.mark(function o(){var u,c,i,s,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.showLoading=!0,e.prev=1,u=t.formType,c=t.$route.query.copyFrom,i="",!c){e.next=11;break}return e.next=8,t.$axios.get("/api/document/copy/"+c);case 8:i=e.sent,e.next=14;break;case 11:return e.next=13,t.$axios.get(t.url+"/"+t.$route.query.document,{params:{type:u,copyFromId:a}});case 13:i=e.sent;case 14:s="",t.audits=i.data.audits,i.data.count===0?(s=i.data.form,t.actionName="Save"):(s=i.data.data,t.actionName="Update"),t.form=Object.assign({},s),t.defaultItem=Object.assign({},s),c&&(t.form.status="open",t.form.base_id=t.form.id,t.form.base_type=t.form.transaction_type,t.form.base_num=t.form.transaction_no,t.form.transaction_type=t.formType),t.title=t.dialogTitle+" #"+t.form.transaction_no,t.$refs.dialogForm.setTitle(t.title),t.$refs.formDocument.setData(t.form,i.data.columns,i.data.colHeaders),t.showLoading=!1,e.next=30;break;case 26:e.prev=26,e.t0=e.catch(1),l=e.t0.response!==void 0?e.t0.response.data.message:e.t0,t.$swal({type:"error",title:"Error",text:l});case 30:case"end":return e.stop()}},o,null,[[1,26]])}))()},actionSave:function(a){var t=this;this.actionOnSave=a;var o=this.$route.query.document,u=o==="0"?this.url:this.url+"/"+o,c=o==="0"?"post":"patch",i=this.$refs.formDocument.returnData(o),s=this;this.loading=!0,this.showLoading=!0,this.$axios({method:c,url:u,data:i}).then(function(l){switch(t.$nuxt.$emit("snackbar",t.title+" saved!"),t.actionOnSave){case"save":t.$router.push({path:s.formUrl,query:{document:l.data.id}}),setTimeout(function(){t.getDataFromApi()},50);break;case"saveNew":t.$router.push({path:s.formUrl,query:{document:0}}),setTimeout(function(){t.getDataFromApi()},50);break;case"saveClose":t.$refs.dialogForm.closeDialog();break}}).catch(function(l){t.$swal({type:"error",title:"Error",text:l.response.data.message})}).finally(function(l){t.showLoading=!1,t.loading=!1})}}},F=D,k=r(50),b=Object(k.a)(F,g,v,!1,null,null,null),O=m.default=b.exports}}]);
