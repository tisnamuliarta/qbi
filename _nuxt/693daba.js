(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{1082:function(t,e,n){"use strict";n.r(e);var o=n(25),r=n(17),c=(n(74),n(4),n(10),n(27),n(33),n(7),n(46),n(291),n(654)),l=n(689),d=n(1142),f=n(893),h=n(1136),m=n(1139),w=n(709),y=n(679),v=n(775),_=n(894),R=n(911),O=n(1144),D=n(1140),I=n(1141),$=n(896),x=n(731);n(655);Object(l.c)(d.a),Object(l.c)(f.a),Object(l.c)(h.a),Object(l.c)(m.a),Object(w.c)(y.a),Object(v.d)(_.a),Object(v.d)(R.a),Object(v.d)(O.a),Object(v.d)(D.a),Object(v.d)(I.a),Object(v.d)($.a),Object(v.d)(x.a);var C=function(t,e){-1===e.row&&"TD"===t.target.nodeName&&(t.stopImmediatePropagation(),t.stopPropagation(),this.deselectCell())},j={name:"TableDetail",components:{HotTable:c.a},data:function(){return{settings:{licenseKey:"non-commercial-and-evaluation",currentRowClassName:"currentRow",currentColClassName:"currentCol",startRows:1,rowHeaders:!0,manualColumnResize:!0,rowHeights:28,viewportRowRenderingOffset:1e3,viewportColumnRenderingOffset:100,colWidths:80,persistentState:!0,width:"100%",height:"auto",stretchH:"all",hiddenColumns:{copyPasteEnabled:!1,indicator:!1,columns:[1,2,3]},beforeOnCellMouseDown:C,dataSchema:{id:null,item_id:null,sku:null,name:null,description:null,quantity:0,unit:null,default_currency_symbol:null,vat_inclusive:0,price:0,discount_rate:0,tax_name:"",total:0},colHeaders:["#","Id","Item ID","Item Code","Item Code","Description","Qty","Units","Currency","Vat Inclusive","Unit Price","Discount","Tax","Warehouse","Amount",""],columns:[{width:30,wordWrap:!1,renderer:function(t,td,e,n,o,r,c){var button=null,l=window.details;if("closed"!==l.form.status&&"cancel"!==l.form.status)return(button=document.createElement("button")).type="button",button.innerHTML='<span class="mdi mdi-arrow-right-bold"></span>',button.className="btnNPB",button.value="Details",button.addEventListener("mousedown",(function(t){t.preventDefault();var n=l.$refs.details.hotInstance.getDataAtRowProp(e,"whs_name");l.$refs.dialogItem.openDialog(e,n)})),td.innerText="",td.appendChild(button),td}},{data:"id",wordWrap:!1},{data:"item_id",wordWrap:!1},{data:"base_line_id",width:150,readOnly:!0,wordWrap:!1},{data:"code",width:120,readOnly:!0,wordWrap:!1},{data:"narration",width:250,wordWrap:!1},{data:"quantity",width:80,wordWrap:!1,type:"numeric",numericFormat:{pattern:"0,0"}},{data:"unit",className:"htCenter",width:60,readOnly:!0,wordWrap:!1},{data:"default_currency_symbol",width:60,readOnly:!0,wordWrap:!1,className:"htCenter"},{data:"vat_inclusive",type:"checkbox",className:"htCenter",checkedTemplate:1,uncheckedTemplate:0},{data:"amount",width:100,wordWrap:!1,type:"numeric",numericFormat:{pattern:"0,0.00"}},{data:"discount_rate",width:100,wordWrap:!1,type:"numeric",numericFormat:{pattern:"0,0.00"}},{data:"tax_name",width:100,height:26,wordWrap:!1,editor:"select",className:"htCenter",selectOptions:function(){return window.details.$auth.$storage.getState("tax")},visibleRows:5,strict:!0,filter:!1,allowInvalid:!1},{data:"whs_name",width:100,height:26,wordWrap:!1,editor:"select",className:"htCenter",selectOptions:function(){return window.details.$auth.$storage.getState("warehouse")},visibleRows:5,strict:!0,filter:!1,allowInvalid:!1},{data:"sub_total",width:100,wordWrap:!1,type:"numeric",readOnly:!0,numericFormat:{pattern:"0,0.00"}},{width:40,wordWrap:!1,renderer:function(t,td,e,n,o,r,c){var button=null,l=window.details;return"closed"!==l.form.status&&"cancel"!==l.form.status&&((button=document.createElement("button")).type="button",button.innerHTML='<span class="mdi mdi-delete"></span>',button.className="btnDelete",button.value="Details2",button.addEventListener("mousedown",(function(t){t.preventDefault(),l.removeRow(e)})),td.innerText="",td.appendChild(button)),td}}]},detailsRoot:"detailsRoot",colHeaders:[],form:{}}},created:function(){this.setInstance()},methods:{setInstance:function(){window.details=this},removeRow:function(t){this.$refs.details.hotInstance.alter("remove_row",t)},addLine:function(){var t=this,e=this;this.$refs.details.hotInstance.batch((function(){var n=t.$refs.details.hotInstance.countRows();t.$refs.details.hotInstance.alter("insert_row",n+1,1),t.$refs.details.hotInstance.setDataAtRowProp([[n,"whs_name",e.form.warehouse_name]])}))},updateTableSettings:function(header){this.$refs.details.hotInstance.updateSettings({licenseKey:"non-commercial-and-evaluation",height:"auto",beforeRefreshDimensions:function(){return!1},beforeOnCellMouseDown:C,afterRemoveRow:function(t,e,n,source){window.details.calculateTotal()},beforeRemoveRow:function(t,e,n,source){var o=window.details,r=[];return n.forEach((function(t,e){var n=o.$refs.details.hotInstance.getDataAtCell(t,0);n&&r.push(n)})),1===o.$refs.details.hotInstance.countRows()&&o.$emit("calcTotal",{subTotal:0,amount:0,discountAmount:0,taxDetail:[]}),r.length>0&&o.$emit("removeData",{id:r}),!0},afterChange:function(t,source){var e=window.details;if(t){var n=0;t.forEach((function(t){var o=Object(r.a)(t,4),c=(o[0],o[1]),l=o[2],d=o[3];"quantity"!==(n=c)&&"amount"!==n&&"discount_rate"!==n&&"tax_name"!==n||l!==d&&e.calculateTotal()}))}},beforeRender:function(t){window.details.$nuxt.$loading.start()},afterRender:function(t){window.details.$nuxt.$loading.finish()},afterLoadData:function(t,e,source){}})},selectItems:function(data){var t=data.row,e=data.selected,n=this.form.transaction_type,o=this,r=["SQ","SO","SD","IN","RC","CN","SR"];this.$refs.details.hotInstance.batch((function(){e.forEach((function(e,c){var l=null!=e.sales_tax?e.sales_tax.name:null,d=r.includes(n)?e.sale_price:e.purchase_price,f=e.description?e.description:e.name;o.$refs.details.hotInstance.setDataAtRowProp([[t,"code",e.code],[t,"base_line_id",0],[t,"unit",e.unit],[t,"narration",f],[t,"default_currency_symbol",o.form.default_currency_code],[t,"item_id",e.id],[t,"amount",d],[t,"tax_name",l],[t,"whs_name",e.whs_name],[t,"quantity",1]]),t++}))}))},setDataToDetails:function(data,form){var t=this,e=this;this.form=form,this.$refs.details.hotInstance.batch((function(){t.updateTableSettings();var n=form.line_items.length>0?form.line_items:data;if(e.$refs.details.hotInstance.loadData(n),0===form.line_items.length)for(var o=t.$refs.details.hotInstance.countRows(),i=0;i<o;i++)t.$refs.details.hotInstance.setDataAtRowProp(i,"whs_name",e.form.warehouse_name);t.$nuxt.$loading.finish()}))},calculateTotal:function(){var t=this,e=this.$refs.details.hotInstance.countRows(),n=0,o=0,r=[],c=0,l=0;if(e>0)for(var d=function(i){t.$refs.details.hotInstance.batch((function(){var e=t.$refs.details.hotInstance.getDataAtRowProp(i,"quantity"),d=t.$refs.details.hotInstance.getDataAtRowProp(i,"amount"),f=t.$refs.details.hotInstance.getDataAtRowProp(i,"discount_rate"),h=t.$refs.details.hotInstance.getDataAtRowProp(i,"tax_name"),m=e*d;n+=e*d;var w=parseFloat(f/100*m).toFixed(2);if(o=parseFloat(o)+parseFloat(w),l=m-w,h){var y=0;t.$auth.$storage.getState("tax_row").forEach((function(t,e){t.name===h&&(y=parseFloat(t.rate))}));var v=parseFloat(y)/100*l;r.push({name:h,amount:v})}c+=m-w,t.$refs.details.hotInstance.setDataAtRowProp(i,"sub_total",l)}))},i=0;i<e;i++)d(i);this.$emit("calcTotal",{subTotal:n,amount:c,discountAmount:o,taxDetail:r})},getTaxRate:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.$axios.get("/api/financial/taxes/0",{params:{name:t}});case 2:return o=n.sent,n.abrupt("return",o.data.data.rows);case 4:case"end":return n.stop()}}),n)})))()},getDataAtRowPro:function(t,e){return this.$refs.details.hotInstance.getDataAtRowProp(t,e)},countRows:function(){return this.$refs.details.hotInstance.countRows()},checkIfEmptyRow:function(t){return this.$refs.details.hotInstance.isEmptyRow(t)},getAddData:function(t){if("0"===t)for(var e=this.$refs.details.hotInstance.countRows(),i=0;i<e;i++)this.$refs.details.hotInstance.setDataAtRowProp(i,"id",null);return this.$refs.details.hotInstance.getSourceData()}}},k=n(50),component=Object(k.a)(j,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"scroll-container-min",attrs:{id:"parentContainer"}},[e("hot-table",{ref:"details",attrs:{root:t.detailsRoot,settings:t.settings}}),t._v(" "),e("LazyInventoryDialogItem",{ref:"dialogItem",attrs:{"view-data":!0,"show-add-btn":!1},on:{selectItems:t.selectItems}})],1)}),[],!1,null,null,null);e.default=component.exports},679:function(t,e,n){"use strict";n.d(e,"a",(function(){return D}));n(606),n(604),n(4),n(110),n(623),n(12),n(7),n(46),n(53),n(212),n(32),n(35);var o=n(870),r=n(605),c=n(601);function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var base=m(t,e);if(base){var desc=Object.getOwnPropertyDescriptor(base,e);return desc.get?desc.get.call(arguments.length<3?t:n):desc.value}},h.apply(this,arguments)}function m(object,t){for(;!Object.prototype.hasOwnProperty.call(object,t)&&null!==(object=_(object)););return object}function w(t,p){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,p){return t.__proto__=p,t},w(t,p)}function y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=_(t);if(e){var r=_(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return v(this,n)}}function v(t,e){if(e&&("object"===l(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _(t){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_(t)}var R="ht_editor_visible",O="selectEditor",D=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&w(t,e)}(D,t);var e,n,m,v=y(D);function D(){return d(this,D),v.apply(this,arguments)}return e=D,m=[{key:"EDITOR_TYPE",get:function(){return"select"}}],(n=[{key:"init",value:function(){this.select=this.hot.rootDocument.createElement("SELECT"),Object(r.a)(this.select,"htSelectEditor"),this.select.style.display="none",this.hot.rootElement.appendChild(this.select),this.registerHooks()}},{key:"getValue",value:function(){return this.select.value}},{key:"setValue",value:function(t){this.select.value=t}},{key:"open",value:function(){this._opened=!0,this.refreshDimensions(),this.select.style.display="",this.hot.getShortcutManager().setActiveContextName("editor"),this.registerShortcuts()}},{key:"close",value:function(){this._opened=!1,this.select.style.display="none",Object(r.v)(this.select,R)&&Object(r.K)(this.select,R),this.unregisterShortcuts(),this.clearHooks()}},{key:"focus",value:function(){this.select.focus()}},{key:"registerHooks",value:function(){var t=this;this.addHook("afterScrollHorizontally",(function(){return t.refreshDimensions()})),this.addHook("afterScrollVertically",(function(){return t.refreshDimensions()})),this.addHook("afterColumnResize",(function(){return t.refreshDimensions()})),this.addHook("afterRowResize",(function(){return t.refreshDimensions()}))}},{key:"prepare",value:function(t,col,e,td,n,o){var l=this;h(_(D.prototype),"prepare",this).call(this,t,col,e,td,n,o);var d,f=this.cellProperties.selectOptions;d="function"==typeof f?this.prepareOptions(f(this.row,this.col,this.prop)):this.prepareOptions(f),Object(r.e)(this.select),Object(c.o)(d,(function(t,e){var n=l.hot.rootDocument.createElement("OPTION");n.value=e,Object(r.f)(n,t),l.select.appendChild(n)}))}},{key:"prepareOptions",value:function(t){var e={};if(Array.isArray(t))for(var i=0,n=t.length;i<n;i++)e[t[i]]=t[i];else"object"===l(t)&&(e=t);return e}},{key:"refreshValue",value:function(){var t=this.hot.getSourceDataAtCell(this.row,this.prop);this.originalValue=t,this.setValue(t),this.refreshDimensions()}},{key:"refreshDimensions",value:function(){if(this.state===o.b.EDITING)if(this.TD=this.getEditedCell(),this.TD){var t=this.getEditedCellRect(),e=t.top,n=t.start,c=t.width,l=t.height,d=this.select.style;d.height="".concat(l,"px"),d.width="".concat(c,"px"),d.top="".concat(e,"px"),d[this.hot.isRtl()?"right":"left"]="".concat(n,"px"),d.margin="0px",Object(r.a)(this.select,R)}else this.close()}},{key:"registerShortcuts",value:function(){var t=this,e=this.hot.getShortcutManager().getContext("editor"),n={group:O};!1!==this.isInFullEditMode()&&e.addShortcuts([{keys:[["ArrowUp"]],callback:function(){var e=t.select.selectedIndex-1;e>=0&&(t.select[e].selected=!0)}},{keys:[["ArrowDown"]],callback:function(){var e=t.select.selectedIndex+1;e<=t.select.length-1&&(t.select[e].selected=!0)}}],n)}},{key:"unregisterShortcuts",value:function(){this.hot.getShortcutManager().getContext("editor").removeShortcutsByGroup(O)}}])&&f(e.prototype,n),m&&f(e,m),Object.defineProperty(e,"prototype",{writable:!1}),D}(o.a)}}]);