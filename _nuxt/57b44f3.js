(window.webpackJsonp=window.webpackJsonp||[]).push([[168],{1023:function(O,l,a){"use strict";a.r(l);var h=function(){var e=this,t=e._self._c;return t("LazyFormDialogFull",{ref:"dialogForm",on:{arrowLink:e.arrowLink,closeDialog:e.closeDialog},scopedSlots:e._u([{key:"content",fn:function(){return[t("LazyProductionFormProduction",{ref:"formDocument",attrs:{"form-type":e.formType}})]},proxy:!0},{key:"actions",fn:function(){return[e.actionName==="Update"?t("span",[t("v-btn",{attrs:{text:"",small:"",dark:""}},[e._v(`
          More
          `),t("v-menu",{attrs:{transition:"slide-y-transition",bottom:""},scopedSlots:e._u([{key:"activator",fn:function(r){var c=r.on,m=r.attrs;return[t("v-btn",e._g(e._b({attrs:{dark:"",icon:""}},"v-btn",m,!1),c),[t("v-icon",[e._v("mdi-menu-down")])],1)]}}],null,!1,1025138851)},[e._v(" "),t("v-list",{attrs:{link:""}},e._l(e.itemAction,function(s,r){return t("v-list-item",{key:r,on:{click:function(m){return e.actionItem(s.action)}}},[t("v-list-item-content",[t("v-list-item-title",[e._v(e._s(s.text))])],1)],1)}),1)],1)],1)],1):e._e(),e._v(" "),t("v-spacer"),e._v(" "),t("v-btn",{staticClass:"mr-3",attrs:{small:"",color:"green darken-1",dark:"",loading:e.loading,disabled:e.form.status==="closed"},on:{click:function(r){return e.actionSave("save")}}},[e._v(`
        `+e._s(e.actionName)+`

        `),t("v-menu",{attrs:{transition:"slide-y-transition",bottom:""},scopedSlots:e._u([{key:"activator",fn:function(r){var c=r.on,m=r.attrs;return[t("v-btn",e._g(e._b({attrs:{dark:"",icon:"",disabled:e.form.status==="closed"}},"v-btn",m,!1),c),[t("v-icon",[e._v("mdi-menu-down")])],1)]}}])},[e._v(" "),t("v-list",{attrs:{link:""}},e._l(e.items,function(s,r){return t("v-list-item",{key:r,on:{click:function(m){return e.actionSave(s.action)}}},[t("v-list-item-content",[t("v-list-item-title",[e._v(e._s(s.text))])],1)],1)}),1)],1)],1)]},proxy:!0}])},[t("v-overlay",{attrs:{value:e.showLoading}},[t("v-progress-circular",{attrs:{indeterminate:"",size:"64"}})],1)],1)},v=[],g=a(24),d=a(64),C=a(74),E=a(59),x=a(28),N=a(4),P=a(32),U=a(34),j=a(651),R=a(291),y={name:"DialogForm",props:{url:{type:String,default:"/api/production/order"},formType:{type:String,default:"PE"},formUrl:{type:String,default:"/app/form/production/order"},dialogTitle:{type:String,default:"Production order"},tableUrl:{type:String,default:"/app/productions/order"}},data:function(){return{title:this.dialogTitle,items:[{text:"Save and close",action:"saveClose"},{text:"Save and new",action:"saveNew"},{text:"Save and send",action:"saveSend"}],itemAction:[],action:[],breadcrumb:[],form:{},audits:{},defaultItem:{},dialogLoading:!1,showLoading:!0,dialog:!0,loading:!1,actionName:"Save",actionOnSave:"save",countRouter:-1}},head:function(){return{title:this.$t("Production Order")}},activated:function(){var e=this;this.$nextTick(function(){e.$nuxt.$loading.start()}),setTimeout(function(){e.action=[],e.itemAction=[{text:"Copy",action:"copy"},{text:"Cancel",action:"cancel"},{text:"Audit History",action:"history"}],e.itemAction=e.appendItemAction(e.formType),e.$refs.dialogForm.openDialog(),e.getDataFromApi()},500)},methods:{close:function(){this.$emit("getDataFromApi")},checkDisable:function(){return this.form.status==="closed"||this.form.status==="cancel"},appendItemAction:function(e){return this.action=[],[].concat(Object(d.a)(this.action),Object(d.a)(this.itemAction))},closeDialog:function(){this.$router.push({path:this.tableUrl})},arrowLink:function(e){var t=this;this.$refs.dialogForm.showLoading(),this.$axios.get(this.url+"/arrow",{params:{type:this.formType,status:e.status,document:this.$route.query.document}}).then(function(o){t.$router.push({path:t.formUrl,query:{document:o.data.id}}),setTimeout(function(){t.getDataFromApi()},300),t.$refs.dialogForm.finishLoading()}).catch(function(o){t.$refs.dialogForm.finishLoading(),t.$swal({type:"error",title:"Error",text:o.response.data.message})})},getDataFromApi:function(e){var t=this;return Object(g.a)(regeneratorRuntime.mark(function o(){var s,r,c,m,u;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.showLoading=!0,n.prev=1,s=t.formType,r=t.$route.query.copyFrom,c="",!r){n.next=11;break}return n.next=8,t.$axios.get("/api/document/copy/"+r);case 8:c=n.sent,n.next=14;break;case 11:return n.next=13,t.$axios.get(t.url+"/"+t.$route.query.document,{params:{type:s,copyFromId:e}});case 13:c=n.sent;case 14:m="",t.audits=c.data.audits,c.data.count===0?(m=c.data.form,t.actionName="Save"):(m=c.data.data,t.actionName="Update"),t.form=Object.assign({},m),t.defaultItem=Object.assign({},m),r&&(t.form.status="open",t.form.base_id=t.form.id,t.form.base_type=t.form.transaction_type,t.form.base_num=t.form.transaction_no,t.form.transaction_type=t.formType),t.title=t.dialogTitle+" #"+t.form.transaction_no,t.$refs.dialogForm.setTitle(t.title),t.$refs.formDocument.setData(t.form),t.showLoading=!1,n.next=30;break;case 26:n.prev=26,n.t0=n.catch(1),u=n.t0.response!==void 0?n.t0.response.data.message:n.t0,t.$swal({type:"error",title:"Error",text:u});case 30:case"end":return n.stop()}},o,null,[[1,26]])}))()},actionItem:function(e){var t=this;switch(e){case"copy":this.$router.push({path:t.formUrl,query:{document:0}}),this.form.status="open",this.$refs.formDocument.setData(this.form);break;default:this.$router.push({path:t.mappingAction(e),query:{document:0,copyFrom:this.form.id}}),this.form.status="open",this.form.base_id=this.form.id,this.form.base_type=this.form.transaction_type,this.form.base_num=this.form.document_number,this.$refs.formDocument.setData(this.form);break}},mappingAction:function(e){switch(e){case"SQ":return"/app/form/sales/quote";case"SO":return"/app/form/sales/order";case"SD":return"/app/form/sales/delivery";case"IN":return"/app/form/sales/invoice";case"RC":return"/app/form/sales/payment";case"CN":return"/app/form/sales/creditmemo";case"SR":return"/app/form/sales/return";case"PQ":return"/app/form/purchase/quote";case"PO":return"/app/form/purchase/order";case"GR":return"/app/form/purchase/receipt";case"BL":return"/app/form/purchase/invoice";case"PY":return"/app/form/purchase/payment";case"DN":return"/app/form/purchase/creditmemo";case"GN":return"/app/form/purchase/return"}},actionDocument:function(e){var t=this,o=this.$route.query.document;switch(e){case"SQ":case"SO":case"PQ":case"PO":this.$router.push({path:"/dashboard/documents/form",query:{document:0,type:e}}),setTimeout(function(){t.actionName="Save",t.$refs.formDocument.changeValue("type",e),t.$refs.formDocument.changeValue("parent_id",o)},300);break;case"C":this.$refs.formDocument.changeValue("status","cancel"),this.store();break;case"sendEmail":this.openDialogEmail();break}},printAction:function(e){switch(e){case"preview":this.previewDocument();break;case"sendEmail":this.openDialogEmail();break}},openDialogEmail:function(){this.$refs.dialogSendEmail.openEmailDialog(this.form)},previewDocument:function(){var e=this,t=this;this.$refs.dialogForm.showLoading(),this.$axios.get("/api/document/print",{params:{id:t.form.id,type:t.form.transaction_type},responseType:"arraybuffer"}).then(function(o){e.$refs.dialogForm.finishLoading();var s=window.URL.createObjectURL(new Blob([o.data])),r=document.createElement("a");r.href=s,r.setAttribute("download",t.form.transaction_no+".pdf"),document.body.appendChild(r),r.click()}).catch(function(o){e.$refs.dialogForm.finishLoading(),e.$swal({type:"error",title:"Error",text:o.response.data.message})})},actionSave:function(e){var t=this;this.actionOnSave=e;var o=this.$route.query.document,s=o==="0"?this.url:this.url+"/"+o,r=o==="0"?"post":"patch",c=this.$refs.formDocument.returnData(o),m=this;this.loading=!0,this.showLoading=!0,this.$axios({method:r,url:s,data:c}).then(function(u){switch(t.$nuxt.$emit("snackbar",t.title+" saved!"),t.actionOnSave){case"save":t.$router.push({path:m.formUrl,query:{document:u.data.id}}),setTimeout(function(){t.getDataFromApi()},50);break;case"saveNew":t.$router.push({path:m.formUrl,query:{document:0}}),setTimeout(function(){t.getDataFromApi()},50);break;case"saveClose":t.$refs.dialogForm.closeDialog();break}}).catch(function(u){t.$swal({type:"error",title:"Error",text:u.response.data.message})}).finally(function(u){t.showLoading=!1,t.loading=!1})}}},$=y,D=a(50),b=a(51),S=a.n(b),L=a(164),F=a(247),w=a(249),A=a(165),f=a(35),k=a(577),V=a(246),T=a(243),I=a(593),p=Object(D.a)($,h,v,!1,null,null,null),z=l.default=p.exports;S()(p,{VBtn:L.a,VIcon:F.a,VList:w.a,VListItem:A.a,VListItemContent:f.a,VListItemTitle:f.c,VMenu:k.a,VOverlay:V.a,VProgressCircular:T.a,VSpacer:I.a})}}]);
