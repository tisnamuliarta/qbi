(window.webpackJsonp=window.webpackJsonp||[]).push([[162],{1018:function(j,f,o){"use strict";o.r(f);var l=o(165),h=o(248),p=o(249),v=o(166),d=o(31),g=o(578),$=o(247),D=o(222),b=o(589),w=function(){var a=this,t=a._self._c;return t("LazyFormDialogFull",{ref:"dialogForm",on:{arrowLink:a.arrowLink,closeDialog:a.closeDialog},scopedSlots:a._u([{key:"content",fn:function(){return[t("LazyAccountingFormJournal",{ref:"formDocument",attrs:{"form-type":a.formType}})]},proxy:!0},{key:"actions",fn:function(){return[a.actionName==="Update"?t("span",[t(l.a,{attrs:{text:"",small:"",dark:""}},[a._v(`
        More
        `),t(g.a,{attrs:{transition:"slide-y-transition",bottom:""},scopedSlots:a._u([{key:"activator",fn:function(e){var c=e.on,u=e.attrs;return[t(l.a,a._g(a._b({attrs:{dark:"",icon:""}},"v-btn",u,!1),c),[t(h.a,[a._v("mdi-menu-down")])],1)]}}],null,!1,1025138851)},[a._v(" "),t(p.a,{attrs:{link:""}},a._l(a.itemAction,function(s,e){return t(v.a,{key:e,on:{click:function(u){return a.actionItem(s.action)}}},[t(d.b,[t(d.d,[a._v(a._s(s.text))])],1)],1)}),1)],1)],1)],1):a._e(),a._v(" "),t(b.a),a._v(" "),t(l.a,{staticClass:"mr-3",attrs:{small:"",color:"green darken-1",dark:"",loading:a.loading,disabled:a.form.status==="closed"},on:{click:function(e){return a.actionSave("save")}}},[a._v(`
      `+a._s(a.actionName)+`

      `),t(g.a,{attrs:{transition:"slide-y-transition",bottom:""},scopedSlots:a._u([{key:"activator",fn:function(e){var c=e.on,u=e.attrs;return[t(l.a,a._g(a._b({attrs:{dark:"",icon:"",disabled:a.form.status==="closed"}},"v-btn",u,!1),c),[t(h.a,[a._v("mdi-menu-down")])],1)]}}])},[a._v(" "),t(p.a,{attrs:{link:""}},a._l(a.items,function(s,e){return t(v.a,{key:e,on:{click:function(u){return a.actionSave(s.action)}}},[t(d.b,[t(d.d,[a._v(a._s(s.text))])],1)],1)}),1)],1)],1)]},proxy:!0}])},[t($.a,{attrs:{value:a.showLoading}},[t(D.a,{attrs:{indeterminate:"",size:"64"}})],1)],1)},F=[],S=o(24),y=o(63),E=o(73),O=o(58),x=o(28),I=o(4),V=o(33),U=o(35),N=o(650),C=o(292),k={name:"DialogForm",props:{url:{type:String,default:"/api/transactions"},formType:{type:String,default:"JN"},formUrl:{type:String,default:"/app/form/accounting/journal-entry"},dialogTitle:{type:String,default:"Journal Entry"},tableUrl:{type:String,default:"/app/accounting/Journal"}},data:function(){return{title:this.dialogTitle,items:[{text:"Save and close",action:"saveClose"},{text:"Save and new",action:"saveNew"},{text:"Save and send",action:"saveSend"}],itemAction:[],action:[],breadcrumb:[],form:{},audits:{},defaultItem:{},dialogLoading:!1,showLoading:!0,dialog:!0,loading:!1,actionName:"Save",actionOnSave:"save",countRouter:-1}},head:function(){return{title:this.$t("Production Order")}},activated:function(){var a=this;this.$nextTick(function(){a.$nuxt.$loading.start()}),setTimeout(function(){a.action=[],a.itemAction=[{text:"Copy",action:"copy"},{text:"Cancel",action:"cancel"},{text:"Audit History",action:"history"}],a.itemAction=a.appendItemAction(a.formType),a.$refs.dialogForm.openDialog(),a.getDataFromApi()},500)},methods:{close:function(){this.$emit("getDataFromApi")},checkDisable:function(){return this.form.status==="closed"||this.form.status==="cancel"},appendItemAction:function(a){return this.action=[],[].concat(Object(y.a)(this.action),Object(y.a)(this.itemAction))},closeDialog:function(){this.$router.push({path:this.tableUrl})},arrowLink:function(a){var t=this;this.$refs.dialogForm.showLoading(),this.$axios.get(this.url+"/arrow",{params:{type:this.formType,status:a.status,document:this.$route.query.document}}).then(function(n){t.$router.push({path:t.formUrl,query:{document:n.data.id}}),setTimeout(function(){t.getDataFromApi()},300),t.$refs.dialogForm.finishLoading()}).catch(function(n){t.$refs.dialogForm.finishLoading(),t.$swal({type:"error",title:"Error",text:n.response.data.message})})},getDataFromApi:function(a){var t=this;return Object(S.a)(regeneratorRuntime.mark(function n(){var s,e,c,u,m;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t.showLoading=!0,r.prev=1,s=t.formType,e=t.$route.query.copyFrom,c="",!e){r.next=11;break}return r.next=8,t.$axios.get("/api/document/copy/"+e);case 8:c=r.sent,r.next=14;break;case 11:return r.next=13,t.$axios.get(t.url+"/"+t.$route.query.document,{params:{type:s,copyFromId:a}});case 13:c=r.sent;case 14:u="",t.audits=c.data.audits,c.data.count===0?(u=c.data.form,t.actionName="Save"):(u=c.data.data,t.actionName="Update"),t.form=Object.assign({},u),t.defaultItem=Object.assign({},u),e&&(t.form.status="open",t.form.base_id=t.form.id,t.form.base_type=t.form.transaction_type,t.form.base_num=t.form.transaction_no,t.form.transaction_type=t.formType),t.title=t.dialogTitle+" #"+t.form.transaction_no,t.$refs.dialogForm.setTitle(t.title),t.$refs.formDocument.setData(t.form),t.showLoading=!1,r.next=30;break;case 26:r.prev=26,r.t0=r.catch(1),m=r.t0.response!==void 0?r.t0.response.data.message:r.t0,t.$swal({type:"error",title:"Error",text:m});case 30:case"end":return r.stop()}},n,null,[[1,26]])}))()},actionItem:function(a){var t=this;switch(a){case"copy":this.$router.push({path:t.formUrl,query:{document:0}}),this.form.status="open",this.$refs.formDocument.setData(this.form);break;default:this.$router.push({path:t.$formatter.mappingAction(a),query:{document:0,copyFrom:this.form.id}}),this.form.status="open",this.form.base_id=this.form.id,this.form.base_type=this.form.transaction_type,this.form.base_num=this.form.document_number,this.$refs.formDocument.setData(this.form);break}},actionDocument:function(a){var t=this,n=this.$route.query.document;switch(a){case"SQ":case"SO":case"PQ":case"PO":this.$router.push({path:"/dashboard/documents/form",query:{document:0,type:a}}),setTimeout(function(){t.actionName="Save",t.$refs.formDocument.changeValue("type",a),t.$refs.formDocument.changeValue("parent_id",n)},300);break;case"C":this.$refs.formDocument.changeValue("status","cancel"),this.store();break;case"sendEmail":this.openDialogEmail();break}},printAction:function(a){switch(a){case"preview":this.previewDocument();break;case"sendEmail":this.openDialogEmail();break}},openDialogEmail:function(){this.$refs.dialogSendEmail.openEmailDialog(this.form)},previewDocument:function(){var a=this,t=this;this.$refs.dialogForm.showLoading(),this.$axios.get("/api/document/print",{params:{id:t.form.id,type:t.form.transaction_type},responseType:"arraybuffer"}).then(function(n){a.$refs.dialogForm.finishLoading();var s=window.URL.createObjectURL(new Blob([n.data])),e=document.createElement("a");e.href=s,e.setAttribute("download",t.form.transaction_no+".pdf"),document.body.appendChild(e),e.click()}).catch(function(n){a.$refs.dialogForm.finishLoading(),a.$swal({type:"error",title:"Error",text:n.response.data.message})})},actionSave:function(a){var t=this;this.actionOnSave=a;var n=this.$route.query.document,s=n==="0"?this.url:this.url+"/"+n,e=n==="0"?"post":"patch",c=this.$refs.formDocument.returnData(n),u=this;this.loading=!0,this.showLoading=!0,this.$axios({method:e,url:s,data:c}).then(function(m){switch(t.$nuxt.$emit("snackbar",t.title+" saved!"),t.actionOnSave){case"save":t.$router.push({path:u.formUrl,query:{document:m.data.id}}),setTimeout(function(){t.getDataFromApi()},50);break;case"saveNew":t.$router.push({path:u.formUrl,query:{document:0}}),setTimeout(function(){t.getDataFromApi()},50);break;case"saveClose":t.$refs.dialogForm.closeDialog();break}}).catch(function(m){t.$swal({type:"error",title:"Error",text:m.response.data.message})}).finally(function(m){t.showLoading=!1,t.loading=!1})}}},L=k,A=o(50),T=Object(A.a)(L,w,F,!1,null,null,null),J=f.default=T.exports}}]);
