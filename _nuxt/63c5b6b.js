(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{1015:function(O,u,e){"use strict";e.r(u);var h=function(){var a=this,t=a._self._c;return t("LazyFormDialogFull",{ref:"dialogForm",on:{arrowLink:a.arrowLink,closeDialog:a.closeDialog},scopedSlots:a._u([{key:"content",fn:function(){return[t("LazyAccountingFormJournal",{ref:"formDocument",attrs:{"form-type":a.formType}})]},proxy:!0},{key:"actions",fn:function(){return[a.actionName==="Update"?t("span",[t("v-btn",{attrs:{text:"",small:"",dark:""}},[a._v(`
          More
          `),t("v-menu",{attrs:{transition:"slide-y-transition",bottom:""},scopedSlots:a._u([{key:"activator",fn:function(o){var c=o.on,m=o.attrs;return[t("v-btn",a._g(a._b({attrs:{dark:"",icon:""}},"v-btn",m,!1),c),[t("v-icon",[a._v("mdi-menu-down")])],1)]}}],null,!1,1025138851)},[a._v(" "),t("v-list",{attrs:{link:""}},a._l(a.itemAction,function(s,o){return t("v-list-item",{key:o,on:{click:function(m){return a.actionItem(s.action)}}},[t("v-list-item-content",[t("v-list-item-title",[a._v(a._s(s.text))])],1)],1)}),1)],1)],1)],1):a._e(),a._v(" "),t("v-spacer"),a._v(" "),t("v-btn",{staticClass:"mr-3",attrs:{small:"",color:"green darken-1",dark:"",loading:a.loading,disabled:a.form.status==="closed"},on:{click:function(o){return a.actionSave("save")}}},[a._v(`
        `+a._s(a.actionName)+`

        `),t("v-menu",{attrs:{transition:"slide-y-transition",bottom:""},scopedSlots:a._u([{key:"activator",fn:function(o){var c=o.on,m=o.attrs;return[t("v-btn",a._g(a._b({attrs:{dark:"",icon:"",disabled:a.form.status==="closed"}},"v-btn",m,!1),c),[t("v-icon",[a._v("mdi-menu-down")])],1)]}}])},[a._v(" "),t("v-list",{attrs:{link:""}},a._l(a.items,function(s,o){return t("v-list-item",{key:o,on:{click:function(m){return a.actionSave(s.action)}}},[t("v-list-item-content",[t("v-list-item-title",[a._v(a._s(s.text))])],1)],1)}),1)],1)],1)]},proxy:!0}])},[t("v-overlay",{attrs:{value:a.showLoading}},[t("v-progress-circular",{attrs:{indeterminate:"",size:"64"}})],1)],1)},p=[],g=e(24),d=e(64),j=e(74),E=e(59),x=e(28),C=e(4),U=e(32),N=e(34),J=e(651),R=e(291),y={name:"DialogForm",props:{url:{type:String,default:"/api/transactions"},formType:{type:String,default:"JN"},formUrl:{type:String,default:"/app/form/accounting/journal-entry"},dialogTitle:{type:String,default:"Journal Entry"},tableUrl:{type:String,default:"/app/accounting/Journal"}},data:function(){return{title:this.dialogTitle,items:[{text:"Save and close",action:"saveClose"},{text:"Save and new",action:"saveNew"},{text:"Save and send",action:"saveSend"}],itemAction:[],action:[],breadcrumb:[],form:{},audits:{},defaultItem:{},dialogLoading:!1,showLoading:!0,dialog:!0,loading:!1,actionName:"Save",actionOnSave:"save",countRouter:-1}},head:function(){return{title:this.$t("Production Order")}},activated:function(){var a=this;this.$nextTick(function(){a.$nuxt.$loading.start()}),setTimeout(function(){a.action=[],a.itemAction=[{text:"Copy",action:"copy"},{text:"Cancel",action:"cancel"},{text:"Audit History",action:"history"}],a.itemAction=a.appendItemAction(a.formType),a.$refs.dialogForm.openDialog(),a.getDataFromApi()},500)},methods:{close:function(){this.$emit("getDataFromApi")},checkDisable:function(){return this.form.status==="closed"||this.form.status==="cancel"},appendItemAction:function(a){return this.action=[],[].concat(Object(d.a)(this.action),Object(d.a)(this.itemAction))},closeDialog:function(){this.$router.push({path:this.tableUrl})},arrowLink:function(a){var t=this;this.$refs.dialogForm.showLoading(),this.$axios.get(this.url+"/arrow",{params:{type:this.formType,status:a.status,document:this.$route.query.document}}).then(function(n){t.$router.push({path:t.formUrl,query:{document:n.data.id}}),setTimeout(function(){t.getDataFromApi()},300),t.$refs.dialogForm.finishLoading()}).catch(function(n){t.$refs.dialogForm.finishLoading(),t.$swal({type:"error",title:"Error",text:n.response.data.message})})},getDataFromApi:function(a){var t=this;return Object(g.a)(regeneratorRuntime.mark(function n(){var s,o,c,m,l;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t.showLoading=!0,r.prev=1,s=t.formType,o=t.$route.query.copyFrom,c="",!o){r.next=11;break}return r.next=8,t.$axios.get("/api/document/copy/"+o);case 8:c=r.sent,r.next=14;break;case 11:return r.next=13,t.$axios.get(t.url+"/"+t.$route.query.document,{params:{type:s,copyFromId:a}});case 13:c=r.sent;case 14:m="",t.audits=c.data.audits,c.data.count===0?(m=c.data.form,t.actionName="Save"):(m=c.data.data,t.actionName="Update"),t.form=Object.assign({},m),t.defaultItem=Object.assign({},m),o&&(t.form.status="open",t.form.base_id=t.form.id,t.form.base_type=t.form.transaction_type,t.form.base_num=t.form.transaction_no,t.form.transaction_type=t.formType),t.title=t.dialogTitle+" #"+t.form.transaction_no,t.$refs.dialogForm.setTitle(t.title),t.$refs.formDocument.setData(t.form),t.showLoading=!1,r.next=30;break;case 26:r.prev=26,r.t0=r.catch(1),l=r.t0.response!==void 0?r.t0.response.data.message:r.t0,t.$swal({type:"error",title:"Error",text:l});case 30:case"end":return r.stop()}},n,null,[[1,26]])}))()},actionItem:function(a){var t=this;switch(a){case"copy":this.$router.push({path:t.formUrl,query:{document:0}}),this.form.status="open",this.$refs.formDocument.setData(this.form);break;default:this.$router.push({path:t.$formatter.mappingAction(a),query:{document:0,copyFrom:this.form.id}}),this.form.status="open",this.form.base_id=this.form.id,this.form.base_type=this.form.transaction_type,this.form.base_num=this.form.document_number,this.$refs.formDocument.setData(this.form);break}},actionDocument:function(a){var t=this,n=this.$route.query.document;switch(a){case"SQ":case"SO":case"PQ":case"PO":this.$router.push({path:"/dashboard/documents/form",query:{document:0,type:a}}),setTimeout(function(){t.actionName="Save",t.$refs.formDocument.changeValue("type",a),t.$refs.formDocument.changeValue("parent_id",n)},300);break;case"C":this.$refs.formDocument.changeValue("status","cancel"),this.store();break;case"sendEmail":this.openDialogEmail();break}},printAction:function(a){switch(a){case"preview":this.previewDocument();break;case"sendEmail":this.openDialogEmail();break}},openDialogEmail:function(){this.$refs.dialogSendEmail.openEmailDialog(this.form)},previewDocument:function(){var a=this,t=this;this.$refs.dialogForm.showLoading(),this.$axios.get("/api/document/print",{params:{id:t.form.id,type:t.form.transaction_type},responseType:"arraybuffer"}).then(function(n){a.$refs.dialogForm.finishLoading();var s=window.URL.createObjectURL(new Blob([n.data])),o=document.createElement("a");o.href=s,o.setAttribute("download",t.form.transaction_no+".pdf"),document.body.appendChild(o),o.click()}).catch(function(n){a.$refs.dialogForm.finishLoading(),a.$swal({type:"error",title:"Error",text:n.response.data.message})})},actionSave:function(a){var t=this;this.actionOnSave=a;var n=this.$route.query.document,s=n==="0"?this.url:this.url+"/"+n,o=n==="0"?"post":"patch",c=this.$refs.formDocument.returnData(n),m=this;this.loading=!0,this.showLoading=!0,this.$axios({method:o,url:s,data:c}).then(function(l){switch(t.$nuxt.$emit("snackbar",t.title+" saved!"),t.actionOnSave){case"save":t.$router.push({path:m.formUrl,query:{document:l.data.id}}),setTimeout(function(){t.getDataFromApi()},50);break;case"saveNew":t.$router.push({path:m.formUrl,query:{document:0}}),setTimeout(function(){t.getDataFromApi()},50);break;case"saveClose":t.$refs.dialogForm.closeDialog();break}}).catch(function(l){t.$swal({type:"error",title:"Error",text:l.response.data.message})}).finally(function(l){t.showLoading=!1,t.loading=!1})}}},$=y,D=e(50),b=e(51),L=e.n(b),S=e(164),F=e(247),w=e(249),k=e(165),f=e(35),A=e(577),V=e(246),T=e(243),I=e(593),v=Object(D.a)($,h,p,!1,null,null,null),P=u.default=v.exports;L()(v,{VBtn:S.a,VIcon:F.a,VList:w.a,VListItem:k.a,VListItemContent:f.a,VListItemTitle:f.c,VMenu:A.a,VOverlay:V.a,VProgressCircular:T.a,VSpacer:I.a})}}]);
